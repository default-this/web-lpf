@if (selectedScheme$ | ngrxPush; as scheme) {
    @if (scheme.widgets.length) {
        <page-control-scheme-view-control-scheme-widgets-grid [widgetConfigs]="scheme.widgets"
                                                              [editable]="!!(canDeleteOrEditWidgets$ | ngrxPush)"
                                                              (deleteWidget)="onDeleteWidget($event)"
                                                              (editWidget)="onEditWidget($event)"
        ></page-control-scheme-view-control-scheme-widgets-grid>
    }

    <mat-card>
        <mat-card-header>
            <mat-card-title>
                <page-control-scheme-view-control-scheme-general-info [name]="scheme.name"
                                                                      [canEditControlSchemeName]="!!(canRenameScheme$ | ngrxPush)"
                                                                      (nameChange)="onUpdateSchemeName($event)"
                ></page-control-scheme-view-control-scheme-general-info>
            </mat-card-title>
        </mat-card-header>

        <mat-card-content>
            @if (schemeRunBlockers$ | ngrxPush; as blockers) {
                <section class="run-blockers">
                    @for (blocker of blockers; track blocker) {
                        <p class="run-blockers__item">
                            <mat-icon [fontIcon]="'highlight_off'"
                                      [color]="'warn'"
                            ></mat-icon>
                            {{ blocker | controlSchemeRunBlockersL10nPipe | transloco }}
                        </p>
                    }
                </section>
            }

            @if (scheme.bindings.length) {
                <page-control-scheme-view-control-scheme-view-io-list [tree]="schemeViewTree$ | ngrxPush"
                ></page-control-scheme-view-control-scheme-view-io-list>
            } @else {
                <lib-hint>
                    {{ 'controlScheme.bindingsListEmptyNotification' | transloco }}
                </lib-hint>
            }
        </mat-card-content>

        @if (isSmallScreen$ | ngrxPush) {
            <page-control-scheme-view-control-scheme-page-compact-toolbar-controls *libFeatureToolbarControls
                                                                                   [libFeatureToolbarBreadcrumbs]="breadcrumbsDef$ | ngrxPush"
                                                                                   [canRun]="!!(canRunScheme$ | ngrxPush)"
                                                                                   [canStop]="!!(isCurrentControlSchemeRunning$ | ngrxPush)"
                                                                                   [canAddBinding]="!!(canCreateBinding$ | ngrxPush)"
                                                                                   [canExport]="!!(canExportScheme$ | ngrxPush)"
                                                                                   [canDelete]="!!(canDeleteScheme$ | ngrxPush)"
                                                                                   [canAddWidgets]="!!(canAddWidgets$ | ngrxPush)"
                                                                                   [canReorderWidgets]="!!(canReorderWidgets$ | ngrxPush)"
                                                                                   (run)="runScheme(scheme.name)"
                                                                                   (stop)="stopRunningScheme()"
                                                                                   (addBinding)="addBinding()"
                                                                                   (export)="onExport(scheme.name)"
                                                                                   (delete)="onDelete()"
                                                                                   (addWidget)="onAddWidget()"
                                                                                   (reorderWidgets)="onReorderWidgets()"
            ></page-control-scheme-view-control-scheme-page-compact-toolbar-controls>
        } @else {
            <page-control-scheme-view-control-scheme-page-full-toolbar-controls *libFeatureToolbarControls
                                                                                [libFeatureToolbarBreadcrumbs]="breadcrumbsDef$ | ngrxPush"
                                                                                [canRun]="!!(canRunScheme$ | ngrxPush)"
                                                                                [canStop]="!!(isCurrentControlSchemeRunning$ | ngrxPush)"
                                                                                [canAddBinding]="!!(canCreateBinding$ | ngrxPush)"
                                                                                [canExport]="!!(canExportScheme$ | ngrxPush)"
                                                                                [canDelete]="!!(canDeleteScheme$ | ngrxPush)"
                                                                                [canAddWidgets]="!!(canAddWidgets$ | ngrxPush)"
                                                                                [canReorderWidgets]="!!(canReorderWidgets$ | ngrxPush)"
                                                                                (run)="runScheme(scheme.name)"
                                                                                (stop)="stopRunningScheme()"
                                                                                (addBinding)="addBinding()"
                                                                                (export)="onExport(scheme.name)"
                                                                                (delete)="onDelete()"
                                                                                (addWidget)="onAddWidget()"
                                                                                (reorderWidgets)="onReorderWidgets()"
            ></page-control-scheme-view-control-scheme-page-full-toolbar-controls>
        }
    </mat-card>
} @else {
    <lib-hint>
        {{ 'controlScheme.notFound' | transloco }}
    </lib-hint>
}
