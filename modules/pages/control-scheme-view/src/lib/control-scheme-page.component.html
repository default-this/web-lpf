@if (selectedScheme$ | async; as scheme) {
    @if (schemeRunBlockers$ | async; as blockers) {
        @if (blockers.length) {
            <section class="run-blockers">
                @for (blocker of blockers; track blocker) {
                    <p class="run-blockers__item">
                        <mat-icon [fontIcon]="'highlight_off'"
                                  [color]="'warn'"
                        ></mat-icon>
                        {{ blocker | controlSchemeRunBlockersL10nPipe | transloco }}
                    </p>
                }
            </section>
        }
    }

    @if (scheme.widgets.length) {
        <page-control-scheme-view-control-scheme-widgets-grid [widgetConfigs]="scheme.widgets"
                                                              [editable]="!!(canDeleteOrEditWidgets$ | async)"
                                                              (deleteWidget)="onDeleteWidget($event)"
                                                              (editWidget)="onEditWidget($event)"
        ></page-control-scheme-view-control-scheme-widgets-grid>
    }

    <mat-card>
        <mat-card-content>
            @if (scheme.bindings.length) {
                <page-control-scheme-view-control-scheme-view-io-list [tree]="schemeViewTree$ | async"
                ></page-control-scheme-view-control-scheme-view-io-list>
            } @else {
                <lib-hint>
                    {{ 'controlScheme.bindingsListEmptyNotification' | transloco }}
                </lib-hint>
            }
        </mat-card-content>
    </mat-card>

    @if (isSmallScreen$ | async) {
        <page-control-scheme-view-control-scheme-page-compact-toolbar-controls *libFeatureToolbarControls
                                                                               [canRun]="!!(canRunScheme$ | async)"
                                                                               [canStop]="!!(isSchemeRunning | async)"
                                                                               [canAddBinding]="!!(canCreateBinding$ | async)"
                                                                               [canExport]="!!(canExportScheme$ | async)"
                                                                               [canDelete]="!!(canDeleteScheme$ | async)"
                                                                               [canAddWidgets]="!!(canAddWidgets$ | async)"
                                                                               [canReorderWidgets]="!!(canReorderWidgets$ | async)"
                                                                               [renameSchemePath]="renameSchemePath$ | async"
                                                                               (run)="runScheme(scheme.name)"
                                                                               (stop)="stopRunningScheme()"
                                                                               (addBinding)="addBinding()"
                                                                               (export)="onExport(scheme.name)"
                                                                               (delete)="onDelete()"
                                                                               (addWidget)="onAddWidget()"
                                                                               (reorderWidgets)="onReorderWidgets()"
        ></page-control-scheme-view-control-scheme-page-compact-toolbar-controls>
    } @else {
        <page-control-scheme-view-control-scheme-page-full-toolbar-controls [canRun]="!!(canRunScheme$ | async)"
                                                                            [canStop]="!!(isSchemeRunning | async)"
                                                                            [canAddBinding]="!!(canCreateBinding$ | async)"
                                                                            [canExport]="!!(canExportScheme$ | async)"
                                                                            [canDelete]="!!(canDeleteScheme$ | async)"
                                                                            [canAddWidgets]="!!(canAddWidgets$ | async)"
                                                                            [canReorderWidgets]="!!(canReorderWidgets$ | async)"
                                                                            [renameSchemePath]="renameSchemePath$ | async"
                                                                            (run)="runScheme(scheme.name)"
                                                                            (stop)="stopRunningScheme()"
                                                                            (addBinding)="addBinding()"
                                                                            (export)="onExport(scheme.name)"
                                                                            (delete)="onDelete()"
                                                                            (addWidget)="onAddWidget()"
                                                                            (reorderWidgets)="onReorderWidgets()"
        ></page-control-scheme-view-control-scheme-page-full-toolbar-controls>
    }
} @else {
    <lib-hint>
        {{ 'controlScheme.notFound' | transloco }}
    </lib-hint>
}
