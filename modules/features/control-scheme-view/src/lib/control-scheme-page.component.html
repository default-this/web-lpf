<ng-container *ngIf="selectedScheme$ | ngrxPush; let scheme; else schemeNotFound">
    <feat-control-scheme-view-control-scheme-widgets-grid *ngIf="scheme.widgets.length"
                                                          [widgetConfigs]="scheme.widgets"
                                                          [editable]="!!(canDeleteOrEditWidgets$ | ngrxPush)"
                                                          (deleteWidget)="onDeleteWidget($event)"
                                                          (editWidget)="onEditWidget($event)"
    ></feat-control-scheme-view-control-scheme-widgets-grid>

    <mat-card>
        <mat-card-header>
            <mat-card-title>
                <feat-control-scheme-view-control-scheme-general-info [name]="scheme.name"
                                                                      (nameChange)="onUpdateSchemeName($event)"
                ></feat-control-scheme-view-control-scheme-general-info>
            </mat-card-title>
        </mat-card-header>

        <mat-card-content>
            <section *ngIf="schemeRunBlockers$ | ngrxPush; let blockers"
                     class="run-blockers"
            >
                <p *ngFor="let blocker of blockers"
                   class="run-blockers__item"
                >
                    <mat-icon [fontIcon]="'highlight_off'"
                              [color]="'warn'"
                    ></mat-icon>
                    {{ blocker | controlSchemeRunBlockersL10nPipe | transloco }}
                </p>
            </section>
            <section *ngIf="scheme.bindings.length; else bindingsListEmpty">
                <feat-control-scheme-view-control-scheme-view-io-list [tree]="schemeViewTree$ | ngrxPush"
                ></feat-control-scheme-view-control-scheme-view-io-list>
            </section>
        </mat-card-content>

        <ng-container *ngIf="isSmallScreen$ | ngrxPush; else largeScreen">
            <feat-control-scheme-view-control-scheme-page-compact-toolbar *libFeatureToolbarControls
                                                                          [canRun]="!!(canRunScheme$ | ngrxPush)"
                                                                          [canStop]="!!(isCurrentControlSchemeRunning$ | ngrxPush)"
                                                                          [canAddBinding]="!!(canCreateBinding$ | ngrxPush)"
                                                                          [canExport]="!!(canExportScheme$ | ngrxPush)"
                                                                          [canAddWidgets]="!!(canAddWidgets$ | ngrxPush)"
                                                                          (run)="runScheme(scheme.name)"
                                                                          (stop)="stopRunningScheme()"
                                                                          (addBinding)="addBinding()"
                                                                          (export)="onExport(scheme.name)"
                                                                          (delete)="onDelete()"
                                                                          (addWidget)="onAddWidget()"
            ></feat-control-scheme-view-control-scheme-page-compact-toolbar>
        </ng-container>
        <ng-template #largeScreen>
            <feat-control-scheme-view-control-scheme-page-full-toolbar *libFeatureToolbarControls
                                                                       [canRun]="!!(canRunScheme$ | ngrxPush)"
                                                                       [canStop]="!!(isCurrentControlSchemeRunning$ | ngrxPush)"
                                                                       [canAddBinding]="!!(canCreateBinding$ | ngrxPush)"
                                                                       [canExport]="!!(canExportScheme$ | ngrxPush)"
                                                                       [canAddWidgets]="!!(canAddWidgets$ | ngrxPush)"
                                                                       (run)="runScheme(scheme.name)"
                                                                       (stop)="stopRunningScheme()"
                                                                       (addBinding)="addBinding()"
                                                                       (export)="onExport(scheme.name)"
                                                                       (delete)="onDelete()"
                                                                       (addWidget)="onAddWidget()"
            ></feat-control-scheme-view-control-scheme-page-full-toolbar>
        </ng-template>
    </mat-card>
</ng-container>

<ng-template #schemeNotFound>
    <lib-hint>
        {{ 'controlScheme.notFound' | transloco }}
    </lib-hint>
</ng-template>

<ng-template #bindingsListEmpty>
    <lib-hint>
        {{ 'controlScheme.bindingsListEmptyNotification' | transloco }}
    </lib-hint>
</ng-template>
