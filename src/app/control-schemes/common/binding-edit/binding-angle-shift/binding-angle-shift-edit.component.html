<app-binding-edit-sections-container *ngIf="form">
    <app-binding-edit-section [largeScreenWidthPercentage]="33"
                              [caption]="'controlScheme.bindingSectionOutputTitle' | transloco"
    >
        <app-binding-select-hub [control]="form.controls.hubId"
                                [bindingType]="bindingType"
        ></app-binding-select-hub>

        <app-binding-control-select-io [portIdControl]="form.controls.portId"
                                       [hubIdControl]="form.controls.hubId"
                                       [bindingType]="bindingType"
        ></app-binding-control-select-io>
    </app-binding-edit-section>

    <mat-divider [vertical]="true" *appHideOnSmallScreen></mat-divider>

    <app-binding-edit-section [largeScreenWidthPercentage]="33"
                              [caption]="'controlScheme.bindingSectionInputTitle' | transloco"
    >
        <app-controller-select [inputFormGroup]="form.controls.inputs.controls[controlSchemeInputActions.NextLevel]"
                               [title]="controlSchemeInputActions.NextLevel | controlSchemeInputActionToL10nKey | transloco "
        ></app-controller-select>

        <app-controller-select [inputFormGroup]="form.controls.inputs.controls[controlSchemeInputActions.PrevLevel]"
                               [title]="controlSchemeInputActions.PrevLevel | controlSchemeInputActionToL10nKey | transloco "
        ></app-controller-select>

        <app-controller-select [inputFormGroup]="form.controls.inputs.controls[controlSchemeInputActions.Reset]"
                               [title]="controlSchemeInputActions.Reset | controlSchemeInputActionToL10nKey | transloco "
        ></app-controller-select>
    </app-binding-edit-section>

    <mat-divider [vertical]="true" *appHideOnSmallScreen></mat-divider>

    <app-binding-edit-section [largeScreenWidthPercentage]="33"
                              [caption]="'controlScheme.bindingSectionConfigTitle' | transloco"
    >
        <div class="add-level-button-container">
            <button class="add-level-button"
                    mat-raised-button
                    (click)="addNextAngleLevel()"
            >
                {{ 'controlScheme.angleShiftBinding.outputAngleLevelAdd' | transloco }}
            </button>
        </div>

        <div *ngFor="let angleControl of form.controls.angles.controls; let idx = index">
            <mat-form-field>
                <mat-label>
                    {{ 'controlScheme.angleShiftBinding.angleLevel' | transloco: { level: form.controls.initialStepIndex.value - idx } }}
                </mat-label>
                <input type="number"
                       matInput
                       [formControl]="angleControl"
                />
                <button mat-icon-button
                        matSuffix
                        [disabled]="!(canRequestPortValue$ | ngrxPush)"
                        [title]="'controlScheme.angleShiftBinding.readAngleFromPort' | transloco"
                        (click)="onPortAbsolutePositionRequest(idx)"
                >
                    <mat-icon [fontIcon]="'gps_fixed'"></mat-icon>
                </button>
                <button mat-icon-button
                        matSuffix
                        [disabled]="form.controls.initialStepIndex.value === idx"
                        (click)="removeAngleLevel(idx)"
                >
                    <mat-icon [fontIcon]="'delete'"></mat-icon>
                    <span class="cdk-visually-hidden">{{ 'controlScheme.angleShiftBinding.outputAngleLevelRemove' | transloco }}</span>
                </button>
                <mat-error [appValidationMessages]="angleControl"></mat-error>
            </mat-form-field>
        </div>

        <div class="add-level-button-container">
            <button class="add-level-button"
                    mat-raised-button
                    (click)="addPrevAngleLevel()"
            >
                {{ 'controlScheme.angleShiftBinding.outputAngleLevelAdd' | transloco }}
            </button>
        </div>

        <mat-error [appValidationMessages]="form.controls.angles"></mat-error>

        <mat-divider class="sections-divider"></mat-divider>

        <app-slider-control [min]="0"
                            [max]="motorLimits.maxSpeed"
                            [control]="form.controls.speed"
                            [translocoTitle]="'controlScheme.angleShiftBinding.outputSpeed'"
        ></app-slider-control>

        <app-slider-control [min]="motorLimits.minPower"
                            [max]="motorLimits.maxPower"
                            [control]="form.controls.power"
                            [translocoTitle]="'controlScheme.angleShiftBinding.outputPower'"
        ></app-slider-control>

        <app-binding-control-output-end-state [control]="form.controls.endState"
                                              [translocoTitle]="'controlScheme.outputEndStateControlTitle'"
        ></app-binding-control-output-end-state>

        <app-binding-control-select-looping-mode [control]="form.controls.loopingMode"></app-binding-control-select-looping-mode>

        <app-toggle-control [translocoTitle]="'controlScheme.useAccelerationProfile'"
                            [control]="form.controls.useAccelerationProfile"
        ></app-toggle-control>

        <app-toggle-control [translocoTitle]="'controlScheme.useDecelerationProfile'"
                            [control]="form.controls.useDecelerationProfile"
        ></app-toggle-control>
    </app-binding-edit-section>
</app-binding-edit-sections-container>
